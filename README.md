# Kotlin-Validation _(Under Development)_
A multiplatform, declarative, flexible and type-safe Kotlin validation framework.

## Motivation
TODO

## Syntax
### Simple Validators
```kotlin
val nameValidator = validator<String> {
    isNotBlank()
    lengthIn(5..20)
}
nameValidator.matchesAll("123456") //true
nameValidator.matchesAll("1234") //false
nameValidator.matchesAll("") //false
```
### Type Validators
#### Constraints
You can define the domain rules for any type by implementing the `Validator` interface:
```kotlin
object PasswordValidator : Validator<String> {
    override val constraints by describe {
        constraint("TooShort") {
            minLength(7)
        }
        constraint("NoSymbols") {
            listOf('@', '!', '^').forEach { char ->
                doesNotContainChar(char)
            }
        }
    }
}
```

*The validator doesn't need to be an object, it can also be a class and can have value and type parameters.*

Each domain rule for a type is defined by a `constraint` and for each constraint the compiler plugin generates a violation class in a sealed hierarchy as follows:
```kotlin
//AUTO GENERATED BY THE PLUGIN
sealed interface StringViolation {
    object TooShort : StringViolation
    object NoSymbols : StringViolation
}
```
#### Aliases
You can define an alias for the validation type using the `ValidatorConfig` annotation as follows:
```kotlin
@ValidatorConfig(subjectAlias = "Password")
object PasswordValidator : Validator<String> {
    //...
}
```
So the generated violations would look like this:
```kotlin
//AUTO GENERATED BY THE PLUGIN
sealed interface PasswordViolation {
    object TooShort : PasswordViolation
    object NoSymbols : PasswordViolation
}
```
#### Metadata
You can also provide metadata about the violation in the form of properties as follows:
```kotlin
object PasswordValidator : Validator<String> {
    override val constraints by describe {
        constraint("TooShort") {
            meta("min") { 7 }
            meta("actual") { subject.length } //subject refers to the instance being validated
            minLength(7)
        }
        //...
    }
}
```
And the generated violations would look like this:
```kotlin
//AUTO GENERATED BY THE PLUGIN
sealed interface PasswordViolation {
    data class TooShort(
        val min: Int,
        val actual: Int
    ) : PasswordViolation
    object NoSymbols : PasswordViolation
}
```
### Generated Functions
In addition to the violations, the plugin also generates the following extension functions on the validator:
#### validate
Accepts a factory for the item to be validated and returns a result of the type `Case`:
- `Legal` when the item is valid which contains the created item
- `Illegal` when the item is not valid which contains a set of the violations the item has
```kotlin
val result = PasswordValidator.validate {
    "somepassword"
}
when (result) {
    is Case.Legal -> //...
    is Case.Illegal -> //...
}
```
#### isValid
Accepts a factory for the item to be validated and return `true` if it's a valid item, otherwise false:
```kotlin
val result: Boolean = PasswordValidator.isValid {
    "somepassword"
}
```
### Scoped Validations
#### Non-Nullable Properties
You can change the scope of the validation using `on`:
```kotlin
data class Employee(
    val name: String,
    val age: Int
) {
    companion object : Validator<Employee> {
        override val constraints by describe {
            constraint("NameTooShort") {
                on(Employee::name) {
                    minLength(5)
                }
            }
            constraint("NameContainsSymbols") {
                on(Employee::name) {
                    listOf('@', '!', '^').forEach { char ->
                        containsChar(char)
                    }
                }
            }
        }
    }
}
```
Doing so also changes the validation `subject`:
```kotlin
data class Employee(
    val name: String,
    val age: Int
) {
    companion object : Validator<Employee> {
        override val constraints by describe {
            //...
            constraint("NegativeAge") {
                validation { subject.age < 0 }
                //is equal to
                on(Employee::age) {
                    validation { subject < 0 }
                }
            }
        }
    }
}
```
#### Nullable Properties
For nullable properties you need to define the scoping behavior using `ifExists` or `mustExist`:
```kotlin
TODO
```
#### Collection Properties
TODO

### Evaluations
TODO

### Composing Validators
TODO

### Enforced Validation
TODO

### Custom Validations
TODO

### Built-in Validations
TODO
#### Selectors
TODO

### Built-in Validators
TODO

### Testing
TODO


## Features
- Generating sealed interfaces that describe violations (no string matching)
- Generating the `validate` and `isValid` functions per validator
- Support for adding properties to different violations
- Support for Generics
- Support providing extra parameters / type parameters to use during validation
- Support validating the extra parameters to validators
- Support creating validators for Third-party classes.
- Multiple validators per class
- Validators composition
- Ability to enforce classes to be validated before usage
- Declarative type-safe dsl to describe constraints
- Property-specific and class-specific validations
- Nested validations and constraints
- Nesting shortcuts
- Multiplatform ready-to-use validations
- Support doing logical operations on validations
- Validations for elements of different containers
- Easy-to-create custom validations
- Arguments and returned values validation (on-the-fly validators)
- Includes ready-to-use validators (Email, Password, ISBN)

## Roadmap
- Rewrite the compiler plugin for the K2 compiler
- Release
- Add an option to include the success case as a child of the sealed interface, with a couple of helper extensions
- More platform-specific ready-to-use validations
- (Arrow, Kotest, ...) extensions
- Jetpack Compose support
- Adding validations descriptions to be used by the IDE to describe validators
- IDE plugin to test values against constraints on the spot

License
-------

    Copyright (C) 2020 Ahmed Mourad

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

[snapshots]: https://oss.sonatype.org/content/repositories/snapshots/
